<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>noise &#8212; QUSIM 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for noise</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">High-Level Noise Generator for NV Center Simulations</span>

<span class="sd">This module provides a unified interface to compose multiple noise sources</span>
<span class="sd">and efficiently generate noise for quantum simulations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;helper&#39;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">noise_sources</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SYSTEM</span><span class="p">,</span>
    <span class="n">NoiseSource</span><span class="p">,</span>
    <span class="n">C13BathNoise</span><span class="p">,</span>
    <span class="n">ExternalFieldNoise</span><span class="p">,</span>
    <span class="n">JohnsonNoise</span><span class="p">,</span>
    <span class="n">ChargeStateNoise</span><span class="p">,</span>
    <span class="n">TemperatureFluctuation</span><span class="p">,</span>
    <span class="n">StrainNoise</span><span class="p">,</span>
    <span class="n">MicrowaveNoise</span><span class="p">,</span>
    <span class="n">OpticalNoise</span>
<span class="p">)</span>


<div class="viewcode-block" id="NoiseConfiguration">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseConfiguration">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">NoiseConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simplified configuration for enabling/disabling noise sources&quot;&quot;&quot;</span>
    
    <span class="c1"># Enable/disable noise sources</span>
    <span class="n">enable_c13_bath</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_external_field</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_johnson</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_charge_noise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_temperature</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_strain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_microwave</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">enable_optical</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Simulation parameters (defaults from system.json)</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">])</span>
    <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Parameter overrides (optional)</span>
    <span class="n">parameter_overrides</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    
<div class="viewcode-block" id="NoiseConfiguration.from_preset">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseConfiguration.from_preset">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_preset</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">preset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NoiseConfiguration&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create configuration from experimental preset&quot;&quot;&quot;</span>
        <span class="n">preset</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_preset</span><span class="p">(</span><span class="n">preset_name</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        
        <span class="c1"># Apply preset-specific settings</span>
        <span class="k">if</span> <span class="s1">&#39;temperature&#39;</span> <span class="ow">in</span> <span class="n">preset</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base_temperature&#39;</span><span class="p">:</span> <span class="n">preset</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]}</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">preset</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]}</span>
            
        <span class="k">if</span> <span class="s1">&#39;depth&#39;</span> <span class="ow">in</span> <span class="n">preset</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;charge_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;surface_distance&#39;</span><span class="p">:</span> <span class="n">preset</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]}</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;conductor_distance&#39;</span><span class="p">:</span> <span class="n">preset</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]}</span>
            
        <span class="k">if</span> <span class="s1">&#39;c13_concentration&#39;</span> <span class="ow">in</span> <span class="n">preset</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span> <span class="n">preset</span><span class="p">[</span><span class="s1">&#39;c13_concentration&#39;</span><span class="p">]}</span>
            
        <span class="k">return</span> <span class="n">config</span></div>

    
<div class="viewcode-block" id="NoiseConfiguration.from_dict">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseConfiguration.from_dict">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NoiseConfiguration&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create configuration from dictionary&quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">config</span></div>
</div>



<div class="viewcode-block" id="NoiseGenerator">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator">[docs]</a>
<span class="k">class</span> <span class="nc">NoiseGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    High-performance noise generator with streaming capabilities</span>
<span class="sd">    </span>
<span class="sd">    Composes multiple noise sources and provides efficient generation methods</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="NoiseGenerator.__init__">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NoiseConfiguration</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize noise generator</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            config: Noise configuration object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span> <span class="ow">or</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        
        <span class="c1"># Initialize enabled noise sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoiseSource</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_sources</span><span class="p">()</span>
        
        <span class="c1"># Cache for performance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spin_operators_cache</span> <span class="o">=</span> <span class="kc">None</span></div>

        
    <span class="k">def</span> <span class="nf">_initialize_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize all enabled noise sources&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_c13_bath</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C13BathNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_external_field</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;external_field&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;external_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ExternalFieldNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_johnson</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;johnson&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JohnsonNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_charge_noise</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;charge_state&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;charge_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChargeStateNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_temperature</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;thermal&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TemperatureFluctuation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_strain</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strain&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">StrainNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_microwave</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;microwave&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;microwave&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MicrowaveNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_optical</span><span class="p">:</span>
            <span class="n">override_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;optical&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;optical&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OpticalNoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span> <span class="n">override_params</span><span class="p">)</span>
            
        <span class="c1"># Set timestep for all sources</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">source</span><span class="o">.</span><span class="n">_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span>
            
<div class="viewcode-block" id="NoiseGenerator.reset">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all noise sources to initial state&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">source</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="NoiseGenerator.set_seed">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.set_seed">[docs]</a>
    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set random seed for reproducibility&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_sources</span><span class="p">()</span></div>

        
    <span class="c1"># Efficient streaming interface</span>
    
<div class="viewcode-block" id="NoiseGenerator.stream_magnetic_noise">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.stream_magnetic_noise">[docs]</a>
    <span class="k">def</span> <span class="nf">stream_magnetic_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                             <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stream magnetic field noise samples in batches</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            n_samples: Total number of samples to generate</span>
<span class="sd">            batch_size: Samples per batch (for memory efficiency)</span>
<span class="sd">            </span>
<span class="sd">        Yields:</span>
<span class="sd">            Batches of magnetic field vectors in Tesla</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samples_generated</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">while</span> <span class="n">samples_generated</span> <span class="o">&lt;</span> <span class="n">n_samples</span><span class="p">:</span>
            <span class="n">current_batch</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">-</span> <span class="n">samples_generated</span><span class="p">)</span>
            
            <span class="c1"># Combine all magnetic noise sources</span>
            <span class="n">b_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">current_batch</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="s1">&#39;c13_bath&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">b_total</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">current_batch</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="s1">&#39;external_field&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">b_total</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;external_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">current_batch</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="s1">&#39;johnson&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="c1"># Johnson noise is generated sample by sample (not vectorized)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">current_batch</span><span class="p">):</span>
                    <span class="n">b_total</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    
            <span class="k">yield</span> <span class="n">b_total</span>
            <span class="n">samples_generated</span> <span class="o">+=</span> <span class="n">current_batch</span></div>

            
<div class="viewcode-block" id="NoiseGenerator.get_total_magnetic_noise">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.get_total_magnetic_noise">[docs]</a>
    <span class="k">def</span> <span class="nf">get_total_magnetic_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get total magnetic field noise from all sources</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            n_samples: Number of samples to generate</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Array of shape (n_samples, 3) or (3,) if n_samples=1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For small samples, direct generation</span>
        <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">b_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="s1">&#39;c13_bath&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">b_total</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="s1">&#39;external_field&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">b_total</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;external_field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="s1">&#39;johnson&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
                    <span class="n">b_total</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    
            <span class="k">return</span> <span class="n">b_total</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="k">if</span> <span class="n">n_samples</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">b_total</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use streaming for large samples</span>
            <span class="n">batches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_magnetic_noise</span><span class="p">(</span><span class="n">n_samples</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span></div>

            
    <span class="c1"># Hamiltonian and Lindblad interfaces</span>
    
<div class="viewcode-block" id="NoiseGenerator.get_noise_hamiltonian">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.get_noise_hamiltonian">[docs]</a>
    <span class="k">def</span> <span class="nf">get_noise_hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                             <span class="n">include_sources</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate noise Hamiltonian contribution</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            spin_operators: Dictionary with &#39;Sx&#39;, &#39;Sy&#39;, &#39;Sz&#39; operators</span>
<span class="sd">            include_sources: List of sources to include (None = all enabled)</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Noise Hamiltonian matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">H_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sx&#39;</span><span class="p">])</span>
        
        <span class="c1"># Magnetic field contribution</span>
        <span class="k">if</span> <span class="n">include_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;magnetic&#39;</span> <span class="ow">in</span> <span class="n">include_sources</span><span class="p">:</span>
            <span class="n">B_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_magnetic_noise</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">H_noise</span> <span class="o">+=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">B_noise</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sx&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">B_noise</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sy&#39;</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">B_noise</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sz&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            
        <span class="c1"># Strain contribution to zero-field splitting</span>
        <span class="k">if</span> <span class="n">include_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;strain&#39;</span> <span class="ow">in</span> <span class="n">include_sources</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;strain&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
                <span class="n">strain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">delta_d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;strain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_zfs_shift</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
                
                <span class="c1"># D term: D(Sz^2 - 2/3)</span>
                <span class="n">S_z2</span> <span class="o">=</span> <span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sz&#39;</span><span class="p">]</span> <span class="o">@</span> <span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sz&#39;</span><span class="p">]</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">S_z2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">H_noise</span> <span class="o">+=</span> <span class="n">delta_d</span> <span class="o">*</span> <span class="p">(</span><span class="n">S_z2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>
                
        <span class="k">return</span> <span class="n">H_noise</span></div>

        
<div class="viewcode-block" id="NoiseGenerator.get_lindblad_operators">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.get_lindblad_operators">[docs]</a>
    <span class="k">def</span> <span class="nf">get_lindblad_operators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spin_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
                              <span class="n">include_sources</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate Lindblad operators for open system dynamics</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            spin_operators: Dictionary with spin operators including &#39;S+&#39;, &#39;S-&#39;, &#39;Sz&#39;</span>
<span class="sd">            include_sources: List of sources to include (None = all enabled)</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            List of (operator, rate) tuples for Lindblad equation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lindblad_ops</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># T1 relaxation from temperature</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">include_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;thermal&#39;</span> <span class="ow">in</span> <span class="n">include_sources</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="s1">&#39;temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">temp_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">]</span>
            <span class="n">current_temp</span> <span class="o">=</span> <span class="n">temp_source</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Calculate relaxation rate</span>
            <span class="n">energy_gap</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;d_gs&#39;</span><span class="p">)</span>  <span class="c1"># Ground state ZFS</span>
            <span class="n">phonon_n</span> <span class="o">=</span> <span class="n">temp_source</span><span class="o">.</span><span class="n">calculate_phonon_occupation</span><span class="p">(</span><span class="n">energy_gap</span><span class="p">)</span>
            
            <span class="c1"># Emission rate (S-)</span>
            <span class="n">phonon_coupling</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_noise_param</span><span class="p">(</span><span class="s1">&#39;thermal&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature_fluctuation&#39;</span><span class="p">,</span> <span class="s1">&#39;phonon_coupling_strength&#39;</span><span class="p">)</span>
            <span class="n">gamma_down</span> <span class="o">=</span> <span class="n">phonon_coupling</span> <span class="o">*</span> <span class="n">energy_gap</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">phonon_n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Absorption rate (S+)  </span>
            <span class="n">gamma_up</span> <span class="o">=</span> <span class="n">phonon_coupling</span> <span class="o">*</span> <span class="n">energy_gap</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">phonon_n</span>
                      
            <span class="k">if</span> <span class="s1">&#39;S-&#39;</span> <span class="ow">in</span> <span class="n">spin_operators</span> <span class="ow">and</span> <span class="n">gamma_down</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lindblad_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;S-&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma_down</span><span class="p">)))</span>
                
            <span class="k">if</span> <span class="s1">&#39;S+&#39;</span> <span class="ow">in</span> <span class="n">spin_operators</span> <span class="ow">and</span> <span class="n">gamma_up</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lindblad_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;S+&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma_up</span><span class="p">)))</span>
                
        <span class="c1"># Pure dephasing from magnetic noise</span>
        <span class="k">if</span> <span class="n">include_sources</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;dephasing&#39;</span> <span class="ow">in</span> <span class="n">include_sources</span><span class="p">:</span>
            <span class="c1"># Estimate dephasing rate from magnetic noise spectrum</span>
            <span class="c1"># This is a simplified model - real calculation would integrate PSD</span>
            <span class="n">gamma_phi</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;typical_dephasing_rate&#39;</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="s1">&#39;Sz&#39;</span> <span class="ow">in</span> <span class="n">spin_operators</span><span class="p">:</span>
                <span class="n">lindblad_ops</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">spin_operators</span><span class="p">[</span><span class="s1">&#39;Sz&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma_phi</span><span class="p">)))</span>
                
        <span class="k">return</span> <span class="n">lindblad_ops</span></div>

        
    <span class="c1"># Specialized noise functions</span>
    
<div class="viewcode-block" id="NoiseGenerator.process_microwave_pulse">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.process_microwave_pulse">[docs]</a>
    <span class="k">def</span> <span class="nf">process_microwave_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nominal_rabi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">phase</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply noise to microwave pulse parameters</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            nominal_rabi: Intended Rabi frequency in Hz</span>
<span class="sd">            duration: Pulse duration in seconds</span>
<span class="sd">            phase: Initial phase in radians</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with noisy pulse parameters vs time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="s1">&#39;rabi_frequency&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">nominal_rabi</span><span class="p">),</span>
            <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">phase</span><span class="p">),</span>
            <span class="s1">&#39;frequency_offset&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="s1">&#39;microwave&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">mw_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;microwave&#39;</span><span class="p">]</span>
            
            <span class="c1"># Apply amplitude noise</span>
            <span class="n">amp_factors</span> <span class="o">=</span> <span class="n">mw_source</span><span class="o">.</span><span class="n">sample_amplitude_factor</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;rabi_frequency&#39;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">amp_factors</span>
            
            <span class="c1"># Apply phase noise (cumulative)</span>
            <span class="n">phase_noise</span> <span class="o">=</span> <span class="n">mw_source</span><span class="o">.</span><span class="n">sample_phase_noise</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">phase_noise</span>
            
            <span class="c1"># Apply frequency drift</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;frequency_offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mw_source</span><span class="o">.</span><span class="n">sample_frequency_offset</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">result</span></div>

        
<div class="viewcode-block" id="NoiseGenerator.process_optical_readout">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.process_optical_readout">[docs]</a>
    <span class="k">def</span> <span class="nf">process_optical_readout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_populations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                               <span class="n">readout_duration</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">n_shots</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulate noisy optical readout</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            state_populations: Dict mapping state names to populations</span>
<span class="sd">            readout_duration: Integration time in seconds</span>
<span class="sd">            n_shots: Number of readout repetitions</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Array of photon counts for each shot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;optical&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Optical noise not enabled, returning ideal readout&quot;</span><span class="p">)</span>
            <span class="c1"># Simple Poisson noise only</span>
            <span class="n">bright_rate</span> <span class="o">=</span> <span class="mf">1e6</span>  <span class="c1"># Typical bright state rate</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">bright_rate</span> <span class="o">*</span> <span class="n">readout_duration</span><span class="p">,</span> <span class="n">n_shots</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">counts</span>
            
        <span class="n">optical</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sources</span><span class="p">[</span><span class="s1">&#39;optical&#39;</span><span class="p">]</span>
        
        <span class="c1"># Define state-dependent photon rates from system.json</span>
        <span class="n">photon_rates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ms=0&#39;</span><span class="p">:</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_noise_param</span><span class="p">(</span><span class="s1">&#39;optical&#39;</span><span class="p">,</span> <span class="s1">&#39;readout&#39;</span><span class="p">,</span> <span class="s1">&#39;bright_state_rate&#39;</span><span class="p">),</span>
            <span class="s1">&#39;ms=+1&#39;</span><span class="p">:</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_noise_param</span><span class="p">(</span><span class="s1">&#39;optical&#39;</span><span class="p">,</span> <span class="s1">&#39;readout&#39;</span><span class="p">,</span> <span class="s1">&#39;dark_state_rate&#39;</span><span class="p">),</span>
            <span class="s1">&#39;ms=-1&#39;</span><span class="p">:</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_noise_param</span><span class="p">(</span><span class="s1">&#39;optical&#39;</span><span class="p">,</span> <span class="s1">&#39;readout&#39;</span><span class="p">,</span> <span class="s1">&#39;dark_state_rate&#39;</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_shots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">shot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shots</span><span class="p">):</span>
            <span class="c1"># Calculate expected signal from state populations</span>
            <span class="n">expected_rate</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">pop</span> <span class="o">*</span> <span class="n">photon_rates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
                <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">state_populations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            
            <span class="c1"># Apply intensity noise</span>
            <span class="n">intensity_factor</span> <span class="o">=</span> <span class="n">optical</span><span class="o">.</span><span class="n">sample_intensity_factor</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">noisy_rate</span> <span class="o">=</span> <span class="n">expected_rate</span> <span class="o">*</span> <span class="n">intensity_factor</span>
            
            <span class="c1"># Generate photon counts</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">shot</span><span class="p">]</span> <span class="o">=</span> <span class="n">optical</span><span class="o">.</span><span class="n">sample_photon_counts</span><span class="p">(</span><span class="n">noisy_rate</span><span class="p">,</span> <span class="n">readout_duration</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">counts</span></div>

        
<div class="viewcode-block" id="NoiseGenerator.estimate_t2_star">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.estimate_t2_star">[docs]</a>
    <span class="k">def</span> <span class="nf">estimate_t2_star</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evolution_time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10e-6</span><span class="p">,</span>
                        <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate T2* from magnetic noise statistics</span>
<span class="sd">        </span>
<span class="sd">        Uses autocorrelation of magnetic noise to estimate dephasing time</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            evolution_time: Time window for correlation analysis</span>
<span class="sd">            n_samples: Number of noise samples</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Estimated T2* in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate magnetic noise trajectory</span>
        <span class="n">b_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_magnetic_noise</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
        
        <span class="c1"># Focus on z-component (most relevant for dephasing)</span>
        <span class="n">b_z</span> <span class="o">=</span> <span class="n">b_noise</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Calculate autocorrelation</span>
        <span class="n">correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">b_z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b_z</span><span class="p">),</span> <span class="n">b_z</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b_z</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">correlation</span> <span class="o">=</span> <span class="n">correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">correlation</span> <span class="o">/=</span> <span class="n">correlation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Find 1/e decay time</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">decay_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">correlation</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">correlation_time</span> <span class="o">=</span> <span class="n">decay_idx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span>
            
            <span class="c1"># T2*  1 / ( * _B * sqrt(_c))</span>
            <span class="c1"># where _B is RMS field noise and _c is correlation time</span>
            <span class="n">sigma_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">b_z</span><span class="p">)</span>
            <span class="n">t2_star</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">correlation_time</span><span class="p">))</span>
            
            <span class="k">return</span> <span class="n">t2_star</span>
            
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># Correlation doesn&#39;t decay - return lower bound</span>
            <span class="k">return</span> <span class="n">evolution_time</span></div>

            
<div class="viewcode-block" id="NoiseGenerator.save_configuration">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.save_configuration">[docs]</a>
    <span class="k">def</span> <span class="nf">save_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current noise configuration to file&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">json</span>
        
        <span class="n">config_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;enable_c13_bath&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_c13_bath</span><span class="p">,</span>
            <span class="s1">&#39;enable_external_field&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_external_field</span><span class="p">,</span>
            <span class="s1">&#39;enable_johnson&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_johnson</span><span class="p">,</span>
            <span class="s1">&#39;enable_charge_noise&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_charge_noise</span><span class="p">,</span>
            <span class="s1">&#39;enable_temperature&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_temperature</span><span class="p">,</span>
            <span class="s1">&#39;enable_strain&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_strain</span><span class="p">,</span>
            <span class="s1">&#39;enable_microwave&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_microwave</span><span class="p">,</span>
            <span class="s1">&#39;enable_optical&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">enable_optical</span><span class="p">,</span>
            <span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
            <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">}</span>
        
        <span class="c1"># Add parameter overrides</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">:</span>
            <span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;parameter_overrides&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span>
        <span class="c1"># ... continue for other parameters</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="NoiseGenerator.load_configuration">
<a class="viewcode-back" href="../api_reference.html#noise.NoiseGenerator.load_configuration">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load_configuration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NoiseGenerator&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load noise generator from saved configuration&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">json</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">config_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            
        <span class="n">config</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">config_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>
</div>



<span class="c1"># Convenience functions for common use cases</span>

<div class="viewcode-block" id="create_realistic_noise_generator">
<a class="viewcode-back" href="../api_reference.html#noise.create_realistic_noise_generator">[docs]</a>
<span class="k">def</span> <span class="nf">create_realistic_noise_generator</span><span class="p">(</span><span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
                                   <span class="n">magnetic_field</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                                   <span class="n">sample_depth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">10e-9</span><span class="p">,</span>
                                   <span class="n">c13_concentration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoiseGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create noise generator with realistic parameters</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        temperature: Sample temperature in Kelvin</span>
<span class="sd">        magnetic_field: Applied field in Tesla</span>
<span class="sd">        sample_depth: NV depth below surface in meters</span>
<span class="sd">        c13_concentration: 13C isotope concentration (None = natural)</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Configured NoiseGenerator instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
    
    <span class="c1"># Set temperature-dependent parameters</span>
    <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;base_temperature&#39;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">}</span>
    <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">}</span>
    
    <span class="c1"># Set depth-dependent parameters</span>
    <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;charge_state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;surface_distance&#39;</span><span class="p">:</span> <span class="n">sample_depth</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;johnson&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;johnson&#39;</span><span class="p">][</span><span class="s1">&#39;conductor_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_depth</span>
    
    <span class="c1"># Set concentration if specified</span>
    <span class="k">if</span> <span class="n">c13_concentration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;c13_bath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span> <span class="n">c13_concentration</span><span class="p">}</span>
        
    <span class="c1"># Adjust noise levels based on conditions</span>
    <span class="k">if</span> <span class="n">temperature</span> <span class="o">&gt;</span> <span class="mi">77</span><span class="p">:</span>  <span class="c1"># Room temperature</span>
        <span class="k">if</span> <span class="s1">&#39;thermal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">][</span><span class="s1">&#39;phonon_coupling_strength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Cryogenic</span>
        <span class="k">if</span> <span class="s1">&#39;thermal&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span><span class="p">[</span><span class="s1">&#39;thermal&#39;</span><span class="p">][</span><span class="s1">&#39;phonon_coupling_strength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>
        
    <span class="k">if</span> <span class="n">magnetic_field</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># High field</span>
        <span class="n">config</span><span class="o">.</span><span class="n">enable_external_field</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Less relevant</span>
        
    <span class="k">return</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>



<div class="viewcode-block" id="create_low_noise_generator">
<a class="viewcode-back" href="../api_reference.html#noise.create_low_noise_generator">[docs]</a>
<span class="k">def</span> <span class="nf">create_low_noise_generator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">NoiseGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create noise generator for ideal/low-noise conditions&quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
    
    <span class="c1"># Disable most noise sources</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_johnson</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_charge_noise</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">config</span><span class="o">.</span><span class="n">enable_external_field</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># Reduce remaining noise levels</span>
    <span class="n">config</span><span class="o">.</span><span class="n">parameter_overrides</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;c13_bath&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;concentration&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">},</span>  <span class="c1"># Isotopically pure</span>
        <span class="s1">&#39;thermal&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;base_temperature&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">},</span>  <span class="c1"># Cryogenic</span>
        <span class="s1">&#39;microwave&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;amplitude_noise&#39;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">},</span>
        <span class="s1">&#39;optical&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;laser_rin&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">QUSIM</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, QUSIM Development Team.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>