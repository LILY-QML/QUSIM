<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>test &#8212; QUSIM 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=8d563738"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for test</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Comprehensive Test Suite for QUSIM NV Center Simulation</span>

<span class="sd">This module contains extensive tests for all QUSIM components including:</span>
<span class="sd">- Core NV system functionality</span>
<span class="sd">- Noise modeling and integration</span>
<span class="sd">- Pulse sequence operations</span>
<span class="sd">- Command-line interface</span>
<span class="sd">- Performance benchmarks</span>
<span class="sd">- Physics validation</span>

<span class="sd">The tests are organized into categories:</span>
<span class="sd">1. Unit tests for individual components</span>
<span class="sd">2. Integration tests for system behavior</span>
<span class="sd">3. Physics validation tests</span>
<span class="sd">4. Performance and regression tests</span>

<span class="sd">Examples:</span>
<span class="sd">    Run all tests:</span>
<span class="sd">        $ python test.py</span>
<span class="sd">        </span>
<span class="sd">    Run specific test category:</span>
<span class="sd">        $ python test.py TestNVSystem</span>
<span class="sd">        </span>
<span class="sd">    Run with coverage:</span>
<span class="sd">        $ coverage run test.py</span>
<span class="sd">        $ coverage report</span>

<span class="sd">Author: QUSIM Development Team</span>
<span class="sd">License: MIT</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="c1"># Add module paths</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;lib&#39;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;helper&#39;</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;modules&#39;</span><span class="p">))</span>

<span class="c1"># Import modules to test</span>
<span class="kn">from</span> <span class="nn">core</span> <span class="kn">import</span> <span class="n">QUSIMCore</span>
<span class="kn">from</span> <span class="nn">nvcore</span> <span class="kn">import</span> <span class="n">NVSystem</span><span class="p">,</span> <span class="n">NVSpinOperators</span><span class="p">,</span> <span class="n">NVSystemHamiltonian</span>
<span class="kn">from</span> <span class="nn">nvcore_fast</span> <span class="kn">import</span> <span class="n">FastNVSystem</span>
<span class="kn">from</span> <span class="nn">noise</span> <span class="kn">import</span> <span class="n">NoiseGenerator</span><span class="p">,</span> <span class="n">NoiseConfiguration</span>
<span class="kn">from</span> <span class="nn">noise_sources</span> <span class="kn">import</span> <span class="n">SYSTEM</span>


<div class="viewcode-block" id="TestNVSpinOperators">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators">[docs]</a>
<span class="k">class</span> <span class="nc">TestNVSpinOperators</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for NV center spin operators.</span>
<span class="sd">    </span>
<span class="sd">    Validates the mathematical properties of spin-1 operators including</span>
<span class="sd">    commutation relations, matrix representations, and algebraic properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestNVSpinOperators.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize spin operators for testing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ops</span> <span class="o">=</span> <span class="n">NVSpinOperators</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_spin_operator_dimensions">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_spin_operator_dimensions">[docs]</a>
    <span class="k">def</span> <span class="nf">test_spin_operator_dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that all spin operators have correct dimensions.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_spin_operator_hermiticity">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_spin_operator_hermiticity">[docs]</a>
    <span class="k">def</span> <span class="nf">test_spin_operator_hermiticity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that spin operators are Hermitian.&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_commutation_relations">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_commutation_relations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_commutation_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test fundamental commutation relations: [Si, Sj] = i*ε_ijk*Sk.</span>
<span class="sd">        </span>
<span class="sd">        For spin-1 system, we verify the SU(2) algebra.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [Sx, Sy] = i*Sz</span>
        <span class="n">commutator_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">commutator_xy</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># [Sy, Sz] = i*Sx</span>
        <span class="n">commutator_yz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">commutator_yz</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># [Sz, Sx] = i*Sy</span>
        <span class="n">commutator_zx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">commutator_zx</span><span class="p">,</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_eigenvalues">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_eigenvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">test_eigenvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that Sz has correct eigenvalues: -1, 0, +1.&quot;&quot;&quot;</span>
        <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">),</span> <span class="n">expected</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_total_spin">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_total_spin">[docs]</a>
    <span class="k">def</span> <span class="nf">test_total_spin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test S² = S·S = 2 for spin-1 system.&quot;&quot;&quot;</span>
        <span class="n">S_squared</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">+</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">+</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz</span><span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">I</span>  <span class="c1"># S(S+1) = 1(1+1) = 2</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">S_squared</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSpinOperators.test_raising_lowering_operators">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSpinOperators.test_raising_lowering_operators">[docs]</a>
    <span class="k">def</span> <span class="nf">test_raising_lowering_operators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test properties of raising and lowering operators.&quot;&quot;&quot;</span>
        <span class="c1"># S+ = Sx + i*Sy</span>
        <span class="n">S_plus_expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">S_plus</span><span class="p">,</span> <span class="n">S_plus_expected</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># S- = Sx - i*Sy  </span>
        <span class="n">S_minus_expected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">Sy</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">S_minus</span><span class="p">,</span> <span class="n">S_minus_expected</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># S+ and S- should be Hermitian conjugates</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">S_plus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">S_minus</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestNVSystemHamiltonian">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian">[docs]</a>
<span class="k">class</span> <span class="nc">TestNVSystemHamiltonian</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for NV center Hamiltonian construction.</span>
<span class="sd">    </span>
<span class="sd">    Validates the physical correctness of the Hamiltonian including</span>
<span class="sd">    zero-field splitting, Zeeman effect, and noise integration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestNVSystemHamiltonian.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize test configuration.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.010</span><span class="p">])</span>  <span class="c1"># Small test field in Tesla</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hamiltonian</span> <span class="o">=</span> <span class="n">NVSystemHamiltonian</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSystemHamiltonian.test_zero_field_splitting">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian.test_zero_field_splitting">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zero_field_splitting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that ZFS term is correctly implemented.&quot;&quot;&quot;</span>
        <span class="c1"># Create Hamiltonian with no magnetic field</span>
        <span class="n">H_zfs</span> <span class="o">=</span> <span class="n">NVSystemHamiltonian</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">H_static</span> <span class="o">=</span> <span class="n">H_zfs</span><span class="o">.</span><span class="n">get_static_hamiltonian</span><span class="p">()</span>
        
        <span class="c1"># Expected ZFS Hamiltonian: D(Sz² - 2/3*I)</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="n">NVSpinOperators</span><span class="p">()</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;d_gs&#39;</span><span class="p">)</span>
        <span class="n">H_expected</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">D</span> <span class="o">*</span> <span class="p">(</span><span class="n">ops</span><span class="o">.</span><span class="n">Sz2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">ops</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
        
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">H_static</span><span class="p">,</span> <span class="n">H_expected</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSystemHamiltonian.test_zeeman_effect">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian.test_zeeman_effect">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zeeman_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test magnetic field interaction (Zeeman effect).&quot;&quot;&quot;</span>
        <span class="n">H_static</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hamiltonian</span><span class="o">.</span><span class="n">get_static_hamiltonian</span><span class="p">()</span>
        
        <span class="c1"># Extract Zeeman contribution</span>
        <span class="n">H_no_field</span> <span class="o">=</span> <span class="n">NVSystemHamiltonian</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">get_static_hamiltonian</span><span class="p">()</span>
        <span class="n">H_zeeman</span> <span class="o">=</span> <span class="n">H_static</span> <span class="o">-</span> <span class="n">H_no_field</span>
        
        <span class="c1"># Expected Zeeman term: γ*B·S</span>
        <span class="n">ops</span> <span class="o">=</span> <span class="n">NVSpinOperators</span><span class="p">()</span>
        <span class="n">gamma_e</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e&#39;</span><span class="p">)</span>
        <span class="n">H_zeeman_expected</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">gamma_e</span> <span class="o">*</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sx</span> <span class="o">+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sy</span> <span class="o">+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ops</span><span class="o">.</span><span class="n">Sz</span>
        <span class="p">)</span>
        
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">H_zeeman</span><span class="p">,</span> <span class="n">H_zeeman_expected</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSystemHamiltonian.test_hamiltonian_hermiticity">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian.test_hamiltonian_hermiticity">[docs]</a>
    <span class="k">def</span> <span class="nf">test_hamiltonian_hermiticity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that Hamiltonian is Hermitian.&quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hamiltonian</span><span class="o">.</span><span class="n">get_static_hamiltonian</span><span class="p">()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">H</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSystemHamiltonian.test_energy_eigenvalues">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystemHamiltonian.test_energy_eigenvalues">[docs]</a>
    <span class="k">def</span> <span class="nf">test_energy_eigenvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that energy eigenvalues are physically reasonable.&quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hamiltonian</span><span class="o">.</span><span class="n">get_static_hamiltonian</span><span class="p">()</span>
        <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
        
        <span class="c1"># Energies should be real</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isreal</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">)))</span>
        
        <span class="c1"># Check energy scale (should be on order of D ~ 2.87 GHz)</span>
        <span class="n">D_hz</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;d_gs&#39;</span><span class="p">)</span>
        <span class="n">max_energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">max_energy</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">D_hz</span><span class="p">)</span>  <span class="c1"># Reasonable upper bound</span></div>
</div>



<div class="viewcode-block" id="TestNVSystem">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystem">[docs]</a>
<span class="k">class</span> <span class="nc">TestNVSystem</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for complete NV system functionality.</span>
<span class="sd">    </span>
<span class="sd">    Tests the integration of all components including evolution,</span>
<span class="sd">    pulse sequences, and noise effects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestNVSystem.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystem.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize NV system for testing.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>  <span class="c1"># 10 mT along z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">NVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNVSystem.test_unitary_evolution">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystem.test_unitary_evolution">[docs]</a>
    <span class="k">def</span> <span class="nf">test_unitary_evolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test unitary evolution preserves trace and hermiticity.&quot;&quot;&quot;</span>
        <span class="c1"># Initial state: |0⟩⟨0|</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># Evolve for short time</span>
        <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">)</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">rho_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="n">rho_history</span><span class="p">:</span>
            <span class="c1"># Check trace preservation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">rho</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            
            <span class="c1"># Check hermiticity</span>
            <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">rho</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
            
            <span class="c1"># Check positive semi-definiteness</span>
            <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvalsh</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">eigenvalues</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1e-10</span><span class="p">))</span></div>

            
<div class="viewcode-block" id="TestNVSystem.test_rabi_oscillations">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystem.test_rabi_oscillations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_rabi_oscillations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test Rabi oscillations under resonant driving.&quot;&quot;&quot;</span>
        <span class="c1"># Initial state: |0⟩</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># Rabi frequency</span>
        <span class="n">rabi_freq</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">10e6</span>  <span class="c1"># 10 MHz</span>
        
        <span class="c1"># Create pulse for one Rabi period</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">10e6</span><span class="p">),</span>  <span class="c1"># π pulse</span>
            <span class="s1">&#39;rabi_frequency&#39;</span><span class="p">:</span> <span class="n">rabi_freq</span><span class="p">,</span>
            <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;detuning&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="c1"># Evolve with pulse</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">rho_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">evolve_with_pulses</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="p">[</span><span class="n">pulse</span><span class="p">])</span>
        
        <span class="c1"># Final state should have population transfer</span>
        <span class="n">rho_final</span> <span class="o">=</span> <span class="n">rho_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># For π pulse, expect population transfer from |0⟩ to |+1⟩</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">rho_final</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># |0⟩ depleted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">rho_final</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># |+1⟩ populated</span></div>

        
<div class="viewcode-block" id="TestNVSystem.test_coherence_decay_with_noise">
<a class="viewcode-back" href="../api_reference.html#test.TestNVSystem.test_coherence_decay_with_noise">[docs]</a>
    <span class="k">def</span> <span class="nf">test_coherence_decay_with_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that coherences decay with noise enabled.&quot;&quot;&quot;</span>
        <span class="c1"># Create system with noise</span>
        <span class="n">noise_config</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
        <span class="n">noise_config</span><span class="o">.</span><span class="n">enable_c13_bath</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">noise_gen</span> <span class="o">=</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="n">noise_config</span><span class="p">)</span>
        <span class="n">noisy_system</span> <span class="o">=</span> <span class="n">NVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">,</span> <span class="n">noise_gen</span><span class="o">=</span><span class="n">noise_gen</span><span class="p">)</span>
        
        <span class="c1"># Initial superposition state</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">psi</span><span class="o">.</span><span class="n">conj</span><span class="p">())</span>
        
        <span class="c1"># Evolve for longer time</span>
        <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">rho_history</span> <span class="o">=</span> <span class="n">noisy_system</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">)</span>
        
        <span class="c1"># Check coherence decay</span>
        <span class="n">coherence_01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="n">rho_history</span><span class="p">])</span>
        <span class="n">coherence_12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">rho</span> <span class="ow">in</span> <span class="n">rho_history</span><span class="p">])</span>
        
        <span class="c1"># Coherences should decay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="n">coherence_12</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">coherence_12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestFastNVSystem">
<a class="viewcode-back" href="../api_reference.html#test.TestFastNVSystem">[docs]</a>
<span class="k">class</span> <span class="nc">TestFastNVSystem</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for optimized fast NV system.</span>
<span class="sd">    </span>
<span class="sd">    Ensures that the fast implementation maintains physical accuracy</span>
<span class="sd">    while providing performance improvements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestFastNVSystem.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestFastNVSystem.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize fast NV system.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_system</span> <span class="o">=</span> <span class="n">FastNVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">,</span> <span class="n">enable_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestFastNVSystem.test_fast_vs_full_consistency">
<a class="viewcode-back" href="../api_reference.html#test.TestFastNVSystem.test_fast_vs_full_consistency">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fast_vs_full_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that fast and full systems give consistent results.&quot;&quot;&quot;</span>
        <span class="c1"># Create both systems</span>
        <span class="n">full_system</span> <span class="o">=</span> <span class="n">NVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">,</span> <span class="n">noise_gen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="c1"># Initial state</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># Evolve both</span>
        <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-8</span><span class="p">)</span>
        <span class="n">times_fast</span><span class="p">,</span> <span class="n">rho_fast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_system</span><span class="o">.</span><span class="n">evolve_unitary</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">times_full</span><span class="p">,</span> <span class="n">rho_full</span> <span class="o">=</span> <span class="n">full_system</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">)</span>
        
        <span class="c1"># Compare at similar time points</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times_fast</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">times_full</span><span class="p">))):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho_fast</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho_full</span><span class="p">):</span>
                <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">rho_fast</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rho_full</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span></div>

                
<div class="viewcode-block" id="TestFastNVSystem.test_noise_caching">
<a class="viewcode-back" href="../api_reference.html#test.TestFastNVSystem.test_noise_caching">[docs]</a>
    <span class="k">def</span> <span class="nf">test_noise_caching</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that noise caching in fast system works correctly.&quot;&quot;&quot;</span>
        <span class="n">fast_noisy</span> <span class="o">=</span> <span class="n">FastNVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B_field</span><span class="p">,</span> <span class="n">enable_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Get multiple noise samples</span>
        <span class="n">noise_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">fast_noisy</span><span class="o">.</span><span class="n">get_hamiltonian</span><span class="p">()</span>
            <span class="n">noise_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            
        <span class="c1"># Check that samples are different (noise is working)</span>
        <span class="n">all_same</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">noise_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sample</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">noise_samples</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">all_same</span><span class="p">,</span> <span class="s2">&quot;Noise samples should be different&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestNoiseGeneration">
<a class="viewcode-back" href="../api_reference.html#test.TestNoiseGeneration">[docs]</a>
<span class="k">class</span> <span class="nc">TestNoiseGeneration</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for noise generation and modeling.</span>
<span class="sd">    </span>
<span class="sd">    Validates statistical properties and physical correctness of</span>
<span class="sd">    all noise sources.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestNoiseGeneration.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestNoiseGeneration.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize noise configuration.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_gen</span> <span class="o">=</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestNoiseGeneration.test_magnetic_noise_statistics">
<a class="viewcode-back" href="../api_reference.html#test.TestNoiseGeneration.test_magnetic_noise_statistics">[docs]</a>
    <span class="k">def</span> <span class="nf">test_magnetic_noise_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test statistical properties of magnetic noise.&quot;&quot;&quot;</span>
        <span class="c1"># Generate many samples</span>
        <span class="n">noise_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="n">noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_gen</span><span class="o">.</span><span class="n">get_total_magnetic_noise</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">noise_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>
            
        <span class="n">noise_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">noise_samples</span><span class="p">)</span>
        
        <span class="c1"># Check mean is near zero</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">noise_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
        
        <span class="c1"># Check variance is reasonable (depends on enabled sources)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">noise_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Should have some noise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">std</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">))</span>  <span class="c1"># But not too much (in Tesla)</span></div>

        
<div class="viewcode-block" id="TestNoiseGeneration.test_noise_source_independence">
<a class="viewcode-back" href="../api_reference.html#test.TestNoiseGeneration.test_noise_source_independence">[docs]</a>
    <span class="k">def</span> <span class="nf">test_noise_source_independence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that different noise sources can be independently controlled.&quot;&quot;&quot;</span>
        <span class="c1"># Test with only C13 bath</span>
        <span class="n">config1</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
        <span class="n">config1</span><span class="o">.</span><span class="n">enable_c13_bath</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">config1</span><span class="o">.</span><span class="n">enable_charge_noise</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">config1</span><span class="o">.</span><span class="n">enable_temperature</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">config1</span><span class="o">.</span><span class="n">enable_johnson</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gen1</span> <span class="o">=</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="n">config1</span><span class="p">)</span>
        
        <span class="c1"># Test with only charge noise</span>
        <span class="n">config2</span> <span class="o">=</span> <span class="n">NoiseConfiguration</span><span class="p">()</span>
        <span class="n">config2</span><span class="o">.</span><span class="n">enable_c13_bath</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">config2</span><span class="o">.</span><span class="n">enable_charge_noise</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">config2</span><span class="o">.</span><span class="n">enable_temperature</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">config2</span><span class="o">.</span><span class="n">enable_johnson</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gen2</span> <span class="o">=</span> <span class="n">NoiseGenerator</span><span class="p">(</span><span class="n">config2</span><span class="p">)</span>
        
        <span class="c1"># Generate samples</span>
        <span class="n">noise1</span> <span class="o">=</span> <span class="n">gen1</span><span class="o">.</span><span class="n">get_total_magnetic_noise</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">noise2</span> <span class="o">=</span> <span class="n">gen2</span><span class="o">.</span><span class="n">get_total_magnetic_noise</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1"># They should be different</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">noise1</span><span class="p">,</span> <span class="n">noise2</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="TestQUSIMCore">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore">[docs]</a>
<span class="k">class</span> <span class="nc">TestQUSIMCore</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test suite for QUSIM command-line interface and core functionality.</span>
<span class="sd">    </span>
<span class="sd">    Tests argument parsing, system initialization, and result processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestQUSIMCore.setUp">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize QUSIM core.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="n">QUSIMCore</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.tearDown">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.tearDown">[docs]</a>
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up temporary files.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">shutil</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.test_argument_parsing">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.test_argument_parsing">[docs]</a>
    <span class="k">def</span> <span class="nf">test_argument_parsing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test command-line argument parsing.&quot;&quot;&quot;</span>
        <span class="c1"># Test fast mode</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--fast&#39;</span><span class="p">,</span> <span class="s1">&#39;--time&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fast</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>
        
        <span class="c1"># Test noise configuration</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--noise&#39;</span><span class="p">,</span> <span class="s1">&#39;c13_bath,charge_noise&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">noise</span><span class="p">,</span> <span class="s1">&#39;c13_bath,charge_noise&#39;</span><span class="p">)</span>
        
        <span class="c1"># Test magnetic field</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;-B&#39;</span><span class="p">,</span> <span class="s1">&#39;0.001&#39;</span><span class="p">,</span> <span class="s1">&#39;0.002&#39;</span><span class="p">,</span> <span class="s1">&#39;0.003&#39;</span><span class="p">])</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">magnetic_field</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.test_noise_configuration">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.test_noise_configuration">[docs]</a>
    <span class="k">def</span> <span class="nf">test_noise_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test noise source configuration from arguments.&quot;&quot;&quot;</span>
        <span class="c1"># Test disabling all noise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--no-noise&#39;</span><span class="p">])</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_configure_noise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">enable_c13_bath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">enable_charge_noise</span><span class="p">)</span>
        
        <span class="c1"># Test specific noise sources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--noise&#39;</span><span class="p">,</span> <span class="s1">&#39;c13_bath,temperature&#39;</span><span class="p">])</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_configure_noise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">enable_c13_bath</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">enable_temperature</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">enable_charge_noise</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.test_initial_state_creation">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.test_initial_state_creation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_initial_state_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test creation of different initial quantum states.&quot;&quot;&quot;</span>
        <span class="c1"># Ground state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--initial-state&#39;</span><span class="p">,</span> <span class="s1">&#39;ground&#39;</span><span class="p">])</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_create_initial_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        
        <span class="c1"># Superposition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span><span class="s1">&#39;--initial-state&#39;</span><span class="p">,</span> <span class="s1">&#39;superposition&#39;</span><span class="p">])</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_create_initial_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.test_pulse_sequence_generation">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.test_pulse_sequence_generation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_pulse_sequence_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test generation of predefined pulse sequences.&quot;&quot;&quot;</span>
        <span class="c1"># Rabi sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;--pulse-sequence&#39;</span><span class="p">,</span> <span class="s1">&#39;rabi&#39;</span><span class="p">,</span> <span class="s1">&#39;--time&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pulses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_create_pulse_sequence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pulses</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pulses</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;duration&#39;</span><span class="p">],</span> <span class="mf">1e-6</span><span class="p">)</span>
        
        <span class="c1"># Ramsey sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;--pulse-sequence&#39;</span><span class="p">,</span> <span class="s1">&#39;ramsey&#39;</span><span class="p">,</span> <span class="s1">&#39;--time&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-6&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">pulses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">_create_pulse_sequence</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pulses</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># π/2 - wait - π/2</span></div>

        
<div class="viewcode-block" id="TestQUSIMCore.test_result_saving">
<a class="viewcode-back" href="../api_reference.html#test.TestQUSIMCore.test_result_saving">[docs]</a>
    <span class="k">def</span> <span class="nf">test_result_saving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that results are properly saved.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">([</span>
            <span class="s1">&#39;--fast&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;--time&#39;</span><span class="p">,</span> <span class="s1">&#39;1e-8&#39;</span><span class="p">,</span>
            <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span>
        <span class="p">])</span>
        
        <span class="c1"># Run simulation</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
        <span class="c1"># Check that file was created</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="n">npz_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npz&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">npz_files</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Load and verify saved data</span>
        <span class="n">saved_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">npz_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">saved_file</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;times&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;populations&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestPhysicsValidation">
<a class="viewcode-back" href="../api_reference.html#test.TestPhysicsValidation">[docs]</a>
<span class="k">class</span> <span class="nc">TestPhysicsValidation</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Physics validation tests.</span>
<span class="sd">    </span>
<span class="sd">    These tests ensure that the simulation produces physically correct results</span>
<span class="sd">    for known scenarios with analytical solutions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestPhysicsValidation.test_free_precession">
<a class="viewcode-back" href="../api_reference.html#test.TestPhysicsValidation.test_free_precession">[docs]</a>
    <span class="k">def</span> <span class="nf">test_free_precession</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test free precession in magnetic field.&quot;&quot;&quot;</span>
        <span class="c1"># System with B field along x</span>
        <span class="n">B_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># 1 mT</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">NVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="n">B_field</span><span class="p">)</span>
        
        <span class="c1"># Initial state: |0⟩</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># Expected precession frequency</span>
        <span class="n">gamma_e</span> <span class="o">=</span> <span class="n">SYSTEM</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s1">&#39;nv_center&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma_e&#39;</span><span class="p">)</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">gamma_e</span> <span class="o">*</span> <span class="n">B_field</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Evolve for one period</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">omega</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">rho_history</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">),</span> <span class="n">dt</span><span class="o">=</span><span class="n">T</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
        
        <span class="c1"># Should return close to initial state after one period</span>
        <span class="n">rho_final</span> <span class="o">=</span> <span class="n">rho_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">rho_final</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">rho0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestPhysicsValidation.test_thermal_equilibrium">
<a class="viewcode-back" href="../api_reference.html#test.TestPhysicsValidation.test_thermal_equilibrium">[docs]</a>
    <span class="k">def</span> <span class="nf">test_thermal_equilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test approach to thermal equilibrium with dissipation.&quot;&quot;&quot;</span>
        <span class="c1"># This would require implementing thermal dissipation</span>
        <span class="c1"># For now, we skip this advanced test</span>
        <span class="k">pass</span></div>

        
<div class="viewcode-block" id="TestPhysicsValidation.test_quantum_zeno_effect">
<a class="viewcode-back" href="../api_reference.html#test.TestPhysicsValidation.test_quantum_zeno_effect">[docs]</a>
    <span class="k">def</span> <span class="nf">test_quantum_zeno_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test quantum Zeno effect with frequent measurements.&quot;&quot;&quot;</span>
        <span class="c1"># This would require implementing measurement operators</span>
        <span class="c1"># For now, we skip this advanced test</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="TestPerformance">
<a class="viewcode-back" href="../api_reference.html#test.TestPerformance">[docs]</a>
<span class="k">class</span> <span class="nc">TestPerformance</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performance benchmarking tests.</span>
<span class="sd">    </span>
<span class="sd">    Ensures that optimizations maintain acceptable performance levels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="TestPerformance.test_fast_mode_speedup">
<a class="viewcode-back" href="../api_reference.html#test.TestPerformance.test_fast_mode_speedup">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fast_mode_speedup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that fast mode provides significant speedup.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        
        <span class="c1"># Test parameters</span>
        <span class="n">B_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">])</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">t_span</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">)</span>
        
        <span class="c1"># Time fast mode</span>
        <span class="n">fast_system</span> <span class="o">=</span> <span class="n">FastNVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="n">B_field</span><span class="p">,</span> <span class="n">enable_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">fast_system</span><span class="o">.</span><span class="n">evolve_unitary</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">fast_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        
        <span class="c1"># Time full mode</span>
        <span class="n">full_system</span> <span class="o">=</span> <span class="n">NVSystem</span><span class="p">(</span><span class="n">B_field</span><span class="o">=</span><span class="n">B_field</span><span class="p">,</span> <span class="n">noise_gen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">full_system</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">)</span>
        <span class="n">full_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        
        <span class="c1"># Fast mode should be significantly faster</span>
        <span class="n">speedup</span> <span class="o">=</span> <span class="n">full_time</span> <span class="o">/</span> <span class="n">fast_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">speedup</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;Fast mode should be at least 2x faster&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="TestPerformance.test_memory_efficiency">
<a class="viewcode-back" href="../api_reference.html#test.TestPerformance.test_memory_efficiency">[docs]</a>
    <span class="k">def</span> <span class="nf">test_memory_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test memory usage remains reasonable for long simulations.&quot;&quot;&quot;</span>
        <span class="c1"># This would require memory profiling</span>
        <span class="c1"># For now, we just ensure simulation completes</span>
        <span class="n">fast_system</span> <span class="o">=</span> <span class="n">FastNVSystem</span><span class="p">(</span><span class="n">enable_noise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">rho0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
        
        <span class="c1"># Run moderately long simulation</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">rho_history</span> <span class="o">=</span> <span class="n">fast_system</span><span class="o">.</span><span class="n">evolve_unitary</span><span class="p">(</span><span class="n">rho0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">),</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        
        <span class="c1"># Should complete without memory errors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho_history</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="run_all_tests">
<a class="viewcode-back" href="../api_reference.html#test.run_all_tests">[docs]</a>
<span class="k">def</span> <span class="nf">run_all_tests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run all test suites and generate coverage report.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        unittest.TestResult: Test results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create test suite</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestLoader</span><span class="p">()</span>
    <span class="n">suite</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestSuite</span><span class="p">()</span>
    
    <span class="c1"># Add all test cases</span>
    <span class="n">test_cases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">TestNVSpinOperators</span><span class="p">,</span>
        <span class="n">TestNVSystemHamiltonian</span><span class="p">,</span>
        <span class="n">TestNVSystem</span><span class="p">,</span>
        <span class="n">TestFastNVSystem</span><span class="p">,</span>
        <span class="n">TestNoiseGeneration</span><span class="p">,</span>
        <span class="n">TestQUSIMCore</span><span class="p">,</span>
        <span class="n">TestPhysicsValidation</span><span class="p">,</span>
        <span class="n">TestPerformance</span>
    <span class="p">]</span>
    
    <span class="k">for</span> <span class="n">test_case</span> <span class="ow">in</span> <span class="n">test_cases</span><span class="p">:</span>
        <span class="n">suite</span><span class="o">.</span><span class="n">addTests</span><span class="p">(</span><span class="n">loader</span><span class="o">.</span><span class="n">loadTestsFromTestCase</span><span class="p">(</span><span class="n">test_case</span><span class="p">))</span>
        
    <span class="c1"># Run tests</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">)</span>
    
    <span class="c1"># Print summary</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tests run: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">testsRun</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failures: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">failures</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Errors: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipped: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">skipped</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Run all tests</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run_all_tests</span><span class="p">()</span>
    
    <span class="c1"># Exit with appropriate code</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">wasSuccessful</span><span class="p">()</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">QUSIM</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, QUSIM Development Team.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>